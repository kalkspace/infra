unms_exporter_host: "unms_exporter:9806"

unms_exporter_token: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  31623362373662326333633735623232373232663662393462316433356264353066306466663939
  3336306164383464663665613935303633343738613663310a643261636639633564363432643565
  34616664316133613439633139613766316637353335663266336331366465343236356332626364
  6161396463313337370a386366643739383733376533353737393030393030363331343237393962
  66653937656261643234386339366131323130613738323639373438356434396532626538353634
  6338383932633834383161356534393164613035666230666236

unms_exporter_config:
  token:
    "kalkspace.unmsapp.com": "{{ unms_exporter_token }}"

unms_exporter:
  service:
    image: ffddorf/unms-exporter:rewrite
    command: ["/usr/local/bin/unms-exporter", "-c", "/config.yml"]
    volumes:
      - "{{ config_dir }}/unms_exporter.yml:/config.yml"

  files:
    - dest: "{{ config_dir }}/unms_exporter.yml"
      content: "{{ unms_exporter_config | to_yaml }}"

  jobs:
    - job_name: "unms_exporter"
      metrics_path: /
      static_configs:
        - targets: "{{ scrape_targets.unms }}"
      relabel_configs: "{{ unms_exporter_relabel }}"

unms_exporter_relabel:
  - target_label: instance
    source_labels: [__address__]
  - target_label: __param_target
    source_labels: [__address__]
  - target_label: __address__
    # The unms exporter's real hostname:port.
    replacement: "{{ unms_exporter_host }}"
